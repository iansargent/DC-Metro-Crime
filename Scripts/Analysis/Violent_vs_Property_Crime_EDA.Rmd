---
title: "Violent_Property_Crime_EDA"
author: "Ian Sargent"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Packages
```{r}
pacman::p_load(tidyverse, sf, MASS)
```


### Read the Dataset
```{r}
df <- st_read(dsn = "https://raw.githubusercontent.com/iansargent/DC-Metro-Crime/refs/heads/main/Data/Combined/master.csv")
```


### Aggregate Specific Crime Counts by Metro Station
```{r}
crime_by_station <- df |> 
  summarize(
    .by = nearest_station_name,
    # Total crime
    total_crime_count = n(),
    # Count specific crime types
    violent_count  = sum(crime_type == "violent",  na.rm = TRUE),
    property_count = sum(crime_type == "property", na.rm = TRUE)
  ) |> 
  mutate(
    # Calculate percentages based on the columns we just created
    pct_violent  = (violent_count / total_crime_count) * 100,
    pct_property = (property_count / total_crime_count) * 100
  ) |> 
  arrange(nearest_station_name)

crime_by_station
```


```{r}
crime_by_tract <- 
  df |> 
  reframe(
    .by = c(name),
    # Total Crime
    total_crime_count = n(),
    population = mean(as.numeric(total_population)),
    poverty_rate = mean(as.numeric(poverty_rate)),
    income = mean(as.numeric(median_household_income)),
    unemployment_rate = mean(as.numeric(unemployment_rate)),
    pct_non_hispanic_black = mean(as.numeric(pct_non_hispanic_black)),
    avg_distance_to_metro = mean(as.numeric(distance_meters))
  )

crime_by_tract
```



```{r}
crime_distance_by_station <- 
  df |> 
  reframe(
    .by = c(nearest_station_name),
    # Total Crime
    total_crime_count = n(),
    avg_distance = mean(as.numeric(distance_meters))
  ) |> 
  arrange(-avg_distance)
```


### Negative Binomial Regression
```{r}
model_simple <- glm.nb(formula = total_crime_count ~ avg_distance_to_metro + offset(log(population)), data=crime_by_tract)

model_comp <- glm.nb(formula = total_crime_count ~ avg_distance_to_metro + offset(log(population)) + poverty_rate + income + unemployment_rate + pct_non_hispanic_black, data=crime_by_tract)
```


```{r}
summary(model_comp)
```


